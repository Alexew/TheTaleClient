#The Tale Client
Android-клиент для многопользовательской zero-player RPG [Сказка](http://the-tale.org).

Поддерживаемые версии Android: 2.3 и выше.

[Страница приложения в Google Play](https://play.google.com/store/apps/details?id=com.lonebytesoft.thetaleclient).  
[Обсуждение на форуме игры](http://the-tale.org/forum/threads/2802).  
[Issue-tracker](https://lonebytesoft.myjetbrains.com/youtrack/issues/thetaleclient).

Высказывать пожелания по работе приложения и сообщать о багах можно на гитхабе, в трекере задач или на форуме.

#The Tale Client SDK
В проекте :sdk находится Java SDK, реализующий общение с API Сказки и некоторые другие функции.  
Имя пакета: com.lonebytesoft.thetaleclient.sdk, далее имена пакетов будут указываться относительно этого имени.

Используются библиотеки org.apache.httpcomponents:httpclient:4.4.1 и org.json:json:20141113 из Maven.

Пример использования можно увидеть в тестовом Java-проекте :desktop.

####Пакет .request
Содержит классы запросов. Необходимо сконструировать нужный запрос и вызвать его метод **execute()**.  
У GET-запросов есть дополнительный метод **setStaleTime(long staleTime)**, позволяющий задать время жизни ответа на этот запрос в кэше. Кэшируются только ответы на GET-запросы.  
Асинхронные (неблокирующие) запросы выполняются прозрачно для пользователя SDK и не требуют никаких дополнительных действий.  
Все запросы выполняются в **текущем потоке**.  
Каждый запрос при выполнении может кинуть **ApiException**, **HttpException** или **UpdateException** (см. далее).
* **AccountInfoRequest**: информация об игроке. Параметры:
    * **String clientId** - идентификатор клиента API;
    * **int accountId** - идентификатор игрока.
* **AuthRequest**: вход в игру. Параметры:
    * **String clientId** - идентификатор клиента API;
    * **String login** - E-mail адрес пользователя;
    * **String password** - пароль пользователя.
* **CombineCardsRequest**: объединить карты из колоды игрока. Параметры:
    * **String clientId** - идентификатор клиента API;
    * **List&lt;Integer&gt; cardIds** - список уникальных идентификаторов карт в колоде игрока.
* **GameInfoRequest**: информация о текущем ходе и герое. Параметры:
    * **String clientId** - идентификатор клиента API;
    * **Integer accountId** *(опциональный)* - идентификатор аккаунта;
    * **GameInfoResponse base** *(опциональный)* - базовый (например, относящийся к предыдущему ходу) ответ на этот же запрос, относительно которого нужно получить разницу; вне зависимости от наличия этого параметра будет возвращен полный ответ.
* **GetCardRequest**: взять новую карту в колоду игрока. Параметры:
    * **String clientId** - идентификатор клиента API.
* **InfoRequest**: базовая информация о текущих параметрах игры и некоторых других данных. Параметры:
    * **String clientId** - идентификатор клиента API.
* **LogoutRequest**: выход из игры. Параметры:
    * **String clientId** - идентификатор клиента API.
* **MapRequest**: информация о карте мира. Параметры:
    * **String dynamicContentUrl** - базовый абсолютный путь к динамическим игровым данным (например, из запроса **InfoRequest**);
    * **String mapVersion** - текущая версия карты мира (например, из запроса **GameInfoRequest**).
* **PerformActionRequest**: использование одной из способностей игрока. Параметры:
    * **String clientId** - идентификатор клиента API;
    * **Action action** - идентификатор способности;
    * **int entityId** *(опциональный)* - идентификатор здания, если способность касается здания, или pvp сражения, если способность касается операций с pvp сражением.
* **QuestChoiceRequest**: изменение пути выполнения задания героем. Параметры:
    * **String clientId** - идентификатор клиента API;
    * **String choiceId** - уникальный идентификатор выбора в задании (например, из запроса **GameInfoRequest**).
* **ThirdPartyAuthRequest**: авторизация приложения для проведения операций от имени пользователя. Параметры:
    * **String clientId** - идентификатор клиента API;
    * **String applicationName** - короткое название приложения;
    * **String applicationInfo** - краткое описание информации об устройстве пользователя;
    * **String applicationDescription** - описание приложения.
* **ThirdPartyAuthStateRequest**: состояние авторизации для текущей сессии. Параметры:
    * **String clientId** - идентификатор клиента API.
* **UseCardRequest**: использовать карту из колоды игрока. Параметры:
    * **String clientId** - идентификатор клиента API;
    * **int cardId** - уникальный идентификатор карты в колоде игрока;
    * **CardTargetType targetType** *(опциональный)* - тип цели карты;
    * **int entityId** _(опциональный, должен быть или не быть вместе с **targetType**)_ - идентификатор советника, если карта применяется к советнику, города, если карта применяется к городу, или здания, если карта применяется к зданию.

####Пакет .response
Содержит классы ответов на запросы. Метод execute() у запросов возвращает классы из этого пакета.  
Каждый ответ имеет поле **String rawResponse**, содержащее нераспарсенный ответ на запрос.

####Пакет .model
Содержит модели данных. Используются в ответах на запросы.  
Каждая модель имеет конструктор **&lt;init&gt;(JSONObject json)**.

####Пакет .dictionary
Содержит словари и списки значений. Используются в ответах на запросы и моделях.  
Каждый словарь содержит **public final** поля **code** и **name** (могут совпадать).

####Пакет .exception
Содержит исключения, которые может кинуть SDK.
* **UpdateException**: кидается при обнаружении факта обновления на сайте.
* **HttpException**: кидается при HTTP статусе ответа на запрос, отличном от 200.
* **ApiException**: общее исключение, кидается при неуспешном запросе к API.

####Пакет .helper
Содержит классы-помощники.
* **MapHelper** - рисование карты мира.
    * **getMapImage** - возвращает **BufferedImage** с картой мира. Параметры:
        * **int width** - желаемая ширина изображения;
        * **int height** - желаемая высота изображения;
        * **MapStyle style** - желаемый стиль карты;
        * **boolean shouldDrawPlaceNames** - нужно ли рисовать имена городов;
        * **MapResponse mapInfo** - информация о карте мира (например, ответ на запрос **MapRequest**);
        * **String staticContentUrl** - базовый абсолютный путь к статическим игровым данным (например, из запроса **InfoRequest**);
        * **List&lt;HeroInfo&gt; heroes** - список моделей информации о героях, которые нужно отобразить на карте (или *null*);
        * **boolean conserveSpace** - нужно ли экономить память за счет качества изображения (экономия при включении около 25%).
    * **getMapImage** - возвращает **BufferedImage** с картой мира со стандартными настройками: размеры тайлов не изменяются, имена городов отображаются, отображается текущий герой, если пользователь залогинен. Для всей нужной информации выполняются соответствующие запросы к API. Параметры:
        * **String clientId** - идентификатор клиента API;
        * **MapStyle style** - желаемый стиль карты.
    * **getMapSize** - возвращает **java.awt.Point** с информацией о стандартном размере изображения карты мира, **Point.x** - ширина изображения, **Point.y** - высота. Параметры:
        * **MapResponse mapInfo** - информация о карте мира (например, ответ на запрос **MapRequest**).
